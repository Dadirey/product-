<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="bg-gradient-to-r from-purple-50 to-blue-100 font-sans p-4">
    <div class="max-w-6xl mx-auto p-6 shadow-lg rounded-lg bg-white my-8">
      <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">
        Sales Dashboard
      </h1>

      <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 mb-6">
        <div>
          <label class="block text-gray-700 text-sm font-bold mb-2"
            >Choose CSV File:</label
          >
          <input
            type="file"
            id="csvFile"
            accept=".csv"
            class="w-full px-3 py-2 border rounded"
          />
        </div>
        <div>
          <label class="block text-gray-700 text-sm font-bold mb-2"
            >Search:</label
          >
          <input
            type="text"
            id="search"
            placeholder="Product Name or S/N"
            class="w-full px-3 py-2 border rounded"
          />
        </div>
        <div>
          <label class="block text-gray-700 text-sm font-bold mb-2"
            >Chart Type:</label
          >
          <select id="chartType" class="w-full px-3 py-2 border rounded">
            <option value="bar">Bar Chart</option>
            <option value="line">Line Chart</option>
            <option value="pie">Pie Chart</option>
            <option value="doughnut">Doughnut Chart</option>
          </select>
        </div>
        <div>
          <label class="block text-gray-700 text-sm font-bold mb-2"
            >Color Saturation:</label
          >
          <input
            type="range"
            id="colorSaturation"
            min="0"
            max="100"
            value="50"
            class="w-full"
          />
        </div>
      </div>

      <div class="overflow-x-auto bg-white rounded-lg shadow-md">
        <table class="min-w-full text-sm text-gray-700">
          <thead id="tableHead" class="bg-gray-50"></thead>
          <tbody id="tableBody" class="divide-y divide-gray-200">
            <tr>
              <td colspan="6" class="text-center py-4">No data loaded yet.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div id="pagination" class="flex justify-center gap-2 mt-4"></div>

      <div class="chart-container h-80 mt-6">
        <canvas id="chart"></canvas>
      </div>

      <button
        onclick="exportData()"
        class="mt-4 px-4 py-2 bg-green-500 text-white rounded-lg block mx-auto hover:bg-green-600"
      >
        Export CSV
      </button>
    </div>

    <script>
      let originalData = [],
        filteredData = [],
        currentPage = 1,
        rowsPerPage = 10;

      document.getElementById("csvFile").addEventListener("change", (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          Papa.parse(e.target.result, {
            header: true,
            skipEmptyLines: true,
            complete: (results) => {
              originalData = results.data;
              filteredData = [...originalData];
              generateTableHeaders(Object.keys(originalData[0]));
              displayData(filteredData);
            },
          });
        };
        reader.readAsText(file);
      });

      const generateTableHeaders = (headers) => {
        document.getElementById("tableHead").innerHTML =
          "<tr>" +
          headers
            .map((header) => `<th class='px-4 py-2'>${header}</th>`)
            .join("") +
          "</tr>";
      };

      const displayData = (data) => {
        document.getElementById("tableBody").innerHTML =
          data.length === 0
            ? `<tr><td colspan='6' class='text-center py-4'>No data available.</td></tr>`
            : data
                .slice(
                  (currentPage - 1) * rowsPerPage,
                  currentPage * rowsPerPage
                )
                .map(
                  (row) =>
                    `<tr>${Object.values(row)
                      .map((val) => `<td class='px-4 py-2'>${val}</td>`)
                      .join("")}</tr>`
                )
                .join("");
        updateChart(data);
      };

      const updateChart = (data) => {
        const ctx = document.getElementById("chart").getContext("2d");
        const chartType = document.getElementById("chartType").value;

        if (window.myChart) window.myChart.destroy();
        window.myChart = new Chart(ctx, {
          type: chartType,
          data: {
            labels: data.map((row) => row["productname"]),
            datasets: [
              {
                label: "Amount",
                data: data.map((row) => parseFloat(row["Amount"]) || 0),
                backgroundColor: "rgba(54, 162, 235, 0.5)",
                borderColor: "rgba(54, 162, 235, 1)",
                borderWidth: 1,
              },
            ],
          },
          options: { responsive: true, maintainAspectRatio: false },
        });
      };

      const exportData = () => {
        const csv = Papa.unparse(originalData);
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "exported_data.csv";
        link.click();
      };
    </script>
  </body>
</html>
